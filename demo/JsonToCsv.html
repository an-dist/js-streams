<!DOCTYPE html>
<title>Json to CSV</title>
<h4>Json to CSV</h4>
<input id="url" type="url" size="100" value="https://jsonplaceholder.typicode.com/posts">
<button id="convert">Convert</button>
<script type="module">
  import * as streams from "https://an-js-streams.pages.dev/mod.mjs"
  import { DownloadStream } from "https://an-js-streams.pages.dev/DownloadStream/DownloadStream.mjs"

  document.getElementById("convert").onclick = async (e) => {
    e.target.disabled = "disabled"

    const url = document.getElementById("url").value
    const responseStream = (await fetch(url, { credentials: "include" })).body

    await responseStream
      .pipeThrough(new TextDecoderStream)
      .pipeThrough(new streams.JsonDeserializerStream)
      .pipeThrough(new streams.CsvLineEncoderStream({ withNewLine: true }))
      .pipeTo(new DownloadStream("download.csv"))

    e.target.disabled = ""
  }
</script>