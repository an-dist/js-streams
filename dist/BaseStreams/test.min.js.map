{
  "version": 3,
  "sources": ["test.ts"],
  "sourcesContent": ["import { BaseDecoder, BaseEncoder, BaseType } from \"./BaseStreams.ts\"\nimport { Utf8DecoderStream, Utf8EncoderStream } from \"../Utf8Streams/Utf8Streams.ts\"\nimport { PerformanceStreamBuilder } from \"../PerformanceStream/PerformanceStream.ts\"\nimport { sleep } from \"../funcs/sleep/sleep.ts\"\n\nconst textSource = (data: string[]) => new ReadableStream<string>({\n  start(controller) {\n    for (const d of data) {\n      controller.enqueue(d)\n    }\n    controller.close()\n  }\n})\n\nconst binarySource = (data: Uint8Array) => new ReadableStream<Uint8Array>({\n  start(controller) {\n    controller.enqueue(data)\n    controller.close()\n  }\n})\n\nconst peek = (result: { encoded: string }) => new TransformStream({\n  transform(chunk, controller) {\n    result.encoded += chunk\n    controller.enqueue(chunk)\n  }\n})\n\nconst terminate = (result: { decoded: string | Array<number> }) => new WritableStream({\n  write(chunk) {\n    if (typeof result.decoded === \"string\") {\n      result.decoded += chunk\n    }\n    else {\n      result.decoded = result.decoded.concat([...chunk])\n    }\n  }\n})\n\nconst testText = async (mode: BaseType, data: string[]) => {\n  console.group(\"Testing(text):\", mode)\n\n  const result = {\n    encoded: \"\",\n    decoded: \"\",\n  }\n\n  await textSource(data)\n    .pipeThrough(new Utf8EncoderStream())\n    .pipeThrough(new BaseEncoder(mode).transformable())\n    .pipeThrough(peek(result))\n    .pipeThrough(new BaseDecoder(mode).transformable())\n    .pipeThrough(new Utf8DecoderStream())\n    .pipeTo(terminate(result))\n\n  console.log(\"source:\", data.join(\"\"), \"(\", data.join(\"\").length, \")\")\n  console.log(`${mode}:`, result.encoded, \"(\", result.encoded.length, \")\")\n  console.log(\"decoded:\", result.decoded, \"(\", result.decoded.length, \")\")\n  console.assert(\n    result.decoded === data.join(\"\"),\n    \"data=[\", JSON.stringify(data.join(\"\")), \"](\", data.join(\"\").length, \")\",\n    \"result=[\", JSON.stringify(result.decoded), \"](\", result.decoded.length, \"),\",\n  )\n  console.groupEnd()\n}\n\nconst testBinary = async (mode: BaseType, data: Uint8Array) => {\n  console.group(\"Testing(binary):\", mode)\n\n  const result = {\n    encoded: \"\",\n    decoded: [],\n  }\n\n  const encodePerf = new PerformanceStreamBuilder(\"encode_perf\", \"encode_start\", \"encode_end\")\n  const decodePerf = new PerformanceStreamBuilder(\"decode_perf\", \"decode_start\", \"decode_end\")\n\n  await binarySource(data)\n    .pipeThrough(encodePerf.pipe(new BaseEncoder(mode).transformable()).build())\n    .pipeThrough(peek(result))\n    .pipeThrough(decodePerf.pipe(new BaseDecoder(mode).transformable()).build())\n    .pipeTo(terminate(result))\n\n  console.log(\"source:\", \"(\", data.byteLength, \")\")\n  console.log(`${mode}:`, \"(\", result.encoded.length, \")\")\n  console.log(\"decoded:\", \"(\", result.decoded.length, \")\")\n  console.assert(\n    result.decoded.every((x, i) => x === data[i]),\n    \"data=[\", data, \"](\", data.byteLength, \")\",\n    \"result=[\", result.decoded, \"](\", result.decoded.length, \"),\",\n  )\n\n  console.group(\"Encode performance\")\n  console.table(encodePerf.result())\n  console.groupEnd()\n  console.group(\"Decode performance\")\n  console.table(decodePerf.result())\n  console.groupEnd()\n\n  console.groupEnd()\n}\n\nconst testBuiltinBase64 = async (data: Uint8Array) => {\n  console.group(\"Testing(Builtin base64):\")\n\n  const result = {\n    encoded: \"\",\n    decoded: [],\n  }\n\n  const encodePerf = new PerformanceStreamBuilder(\"encode_perf\", \"encode_start\", \"encode_end\")\n  const decodePerf = new PerformanceStreamBuilder(\"decode_perf\", \"decode_start\", \"decode_end\")\n\n  await binarySource(data)\n    .pipeThrough(new TransformStream<Uint8Array, string>({\n      transform(chunk, controller) {\n        let s = \"\"\n        for (let i = 0; i < chunk.byteLength; ++i) {\n          s += String.fromCharCode(chunk[i])\n        }\n        controller.enqueue(s)\n      }\n    }))\n    .pipeThrough(encodePerf.pipe(new TransformStream<string, string>({\n      transform(chunk, controller) {\n        controller.enqueue(btoa(chunk))\n      }\n    })).build())\n    .pipeThrough(peek(result))\n    .pipeThrough(decodePerf.pipe(new TransformStream<string, string>({\n      transform(chunk, controller) {\n        controller.enqueue(atob(chunk))\n      }\n    })).build())\n    .pipeThrough(new TransformStream<string, Uint8Array>({\n      transform(chunk, controller) {\n        const buffer: number[] = []\n        for (let i = 0; i < chunk.length; ++i) {\n          buffer.push(chunk[i].charCodeAt(0))\n        }\n        controller.enqueue(new Uint8Array(buffer))\n      }\n    }))\n    .pipeTo(terminate(result))\n\n  console.log(\"source:\", \"(\", data.byteLength, \")\")\n  console.log(\"base64(builtin):\", \"(\", result.encoded.length, \")\")\n  console.log(\"decoded:\", \"(\", result.decoded.length, \")\")\n  console.assert(\n    result.decoded.every((x, i) => x === data[i]),\n    \"data=[\", data, \"](\", data.byteLength, \")\",\n    \"result=[\", result.decoded, \"](\", result.decoded.length, \"),\",\n  )\n\n  console.group(\"Encode performance\")\n  console.table(encodePerf.result())\n  console.groupEnd()\n  console.group(\"Decode performance\")\n  console.table(decodePerf.result())\n  console.groupEnd()\n\n  console.groupEnd()\n}\n\nconst modes: BaseType[] = [\n  \"base16\",\n  \"base32\",\n  \"base32hex\",\n  \"base64\",\n  \"base64url\",\n]\n\nconst stringData = [\n  \"Hello, World.\",\n]\n\nconst binaryData = new Uint8Array(8192 + 3)\nfor (let i = 0; i < binaryData.byteLength; ++i) {\n  binaryData[i] = Math.random() * 0xff\n}\n\nfor (const mode of modes) {\n  await testText(mode, stringData)\n  await sleep()\n  await testBinary(mode, binaryData)\n  await sleep()\n}\nawait testBuiltinBase64(binaryData)\n\nconsole.log(\"Test completed.\")"],
  "mappings": "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",
  "names": ["BaseDecoder", "BaseEncoder", "Utf8DecoderStream", "Utf8EncoderStream", "PerformanceStreamBuilder", "sleep", "textSource", "data", "controller", "d", "binarySource", "peek", "result", "chunk", "terminate", "testText", "mode", "testBinary", "encodePerf", "decodePerf", "x", "i", "testBuiltinBase64", "s", "buffer", "modes", "stringData", "binaryData"]
}
