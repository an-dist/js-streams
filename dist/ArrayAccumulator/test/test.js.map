{
  "version": 3,
  "sources": ["test.ts"],
  "sourcesContent": ["import { ArrayAccumulator } from \"../ArrayAccumulator.ts\"\n\nconst source = (data: any) => new ReadableStream({\n  start(controller) {\n    controller.enqueue(data)\n    controller.close()\n  }\n})\n\nconst logging = () => new TransformStream({\n  transform(chunk, controller) {\n    console.log(chunk)\n    controller.enqueue(chunk)\n  }\n})\n\nconst terminate = () => new WritableStream()\n\nconst testPush = async (size: number, data: any) => {\n  const accumulator = new ArrayAccumulator(size)\n  await accumulator.push(data)\n  for await (const value of accumulator.flush()) {\n    console.log(value)\n  }\n}\n\nconst testFlush = async (size: number, data: any) => {\n  const accumulator = new ArrayAccumulator(size)\n  for await (const value of accumulator.flush(data)) {\n    console.log(value)\n  }\n}\n\nconst testAsyncIterator = async (size: number, data: any) => {\n  const accumulator = new ArrayAccumulator(size)\n  await accumulator.push(data)\n  for await (const value of accumulator) {\n    console.log(value)\n  }\n}\n\nconst testReadable = async (size: number, data: any) => {\n  const accumulator = new ArrayAccumulator(size)\n  await accumulator.readable(data).pipeThrough(logging()).pipeTo(terminate())\n}\n\nconst testTransform = async (size: number, data: any) => {\n  const accumulator = new ArrayAccumulator(size)\n  await source(data).pipeThrough(accumulator.transform()).pipeThrough(logging()).pipeTo(terminate())\n}\n\nconst testWritable = async (size: number, data: any) => {\n  const accumulator = new ArrayAccumulator(size)\n  await source(data).pipeTo(accumulator.writable())\n  for await (const value of accumulator) {\n    console.log(value)\n  }\n}\n\nconst testPerformance = async (size: number, total: number) => {\n  console.groupCollapsed(`size=${size}, total=${total}`)\n  performance.clearMeasures(\"perf\")\n  performance.clearMarks(\"start\")\n  performance.clearMarks(\"end\")\n  performance.mark(\"start\")\n  const accumulator = new ArrayAccumulator(size)\n  for (let i = 0; i < total; ++i) {\n    for await (const value of accumulator.pull(i)) {\n      console.assert(value.length === size, \"flush= false\", \"value=\", value, \"length=\", value.length, \"size=\", size)\n    }\n  }\n  for await (const value of accumulator.flush()) {\n    console.assert(value.length === total % size, \"flush= true\", \"value=\", value, \"length=\", value.length, \"size=\", total % size)\n  }\n  performance.mark(\"end\")\n  performance.measure(\"perf\", \"start\", \"end\")\n  const perf = performance.getEntriesByName(\"perf\")[0]\n  console.log(`duration: ${perf.duration}`)\n  console.groupEnd()\n}\n\nconst testList: { name: string, func: (size: number, data: any) => Promise<void> }[] = [\n  { name: \"Push\", func: testPush },\n  { name: \"Flush\", func: testFlush },\n  { name: \"AsyncIterator\", func: testAsyncIterator },\n  { name: \"Readable\", func: testReadable },\n  { name: \"Transform\", func: testTransform },\n  { name: \"Writable\", func: testWritable },\n]\n\nconst sizeList = [\n  4,\n  5,\n  6,\n]\n\nconst dataList = [\n  undefined,\n  null,\n  \"abc\",\n  123,\n  1.23,\n  [1, 2, 3, 4, 5],\n  [\"aaa\", \"bbb\", \"ccc\", \"ddd\", \"eee\"],\n  [{ a: 1 }, { b: 2 }, { c: 3 }, { d: 4 }, { e: 5 }],\n  function* () { yield 1; yield 2; yield 3; yield 4; yield 5; },\n  async function* () { yield 1; yield 2; yield 3; yield 4; yield 5; },\n]\n\nfor (const test of testList) {\n  console.groupCollapsed(test.name)\n  for (const data of dataList) {\n    for (const size of sizeList) {\n      console.groupCollapsed(`size=${size}, data=${JSON.stringify(data)}`)\n      await test.func(size, data)\n      console.groupEnd()\n    }\n  }\n  console.groupEnd()\n}\n\nconsole.groupCollapsed(\"Performance\")\nawait testPerformance(8, 100000)\nawait testPerformance(32, 100000)\nawait testPerformance(1000, 100000)\nconsole.groupEnd()\n\nconsole.log(\"Test completed.\")"],
  "mappings": "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",
  "names": []
}
