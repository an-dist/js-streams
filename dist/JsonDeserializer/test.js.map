{
  "version": 3,
  "sources": ["test.ts"],
  "sourcesContent": ["import { JsonDeserializer, JsonDeserializerOptions } from \"./JsonDeserializer.ts\"\nimport { SimplePerformanceStreamBuilder } from \"../PerformanceStream/PerformanceStream.ts\"\nimport { sleep } from \"../funcs/sleep/sleep.ts\"\n\nconst source = (s: string) => new ReadableStream({\n  start(controller) {\n    controller.enqueue(s)\n    controller.close()\n  }\n})\n\nconst logging = () => new WritableStream({\n  write(chunk) {\n    console.log(chunk)\n  }\n})\n\nconst terminate = () => new WritableStream()\n\nconst testPerformance = async (data: string, options?: JsonDeserializerOptions) => {\n  const builder = new SimplePerformanceStreamBuilder()\n\n  await source(data)\n    .pipeThrough(builder\n      .pipe(deserializer(options))\n      .build())\n    .pipeTo(terminate())\n\n  console.table(builder.result())\n}\n\nconst deserializer = (options?: JsonDeserializerOptions) => new JsonDeserializer(options).transformable()\n\nconst json = '[\\t\\r\\n{\"a\":1,\"b\":2}\\t,\\r\\n{\"a\":3,\"b\":4\\r},{\"a\":5,\"b\":6}\\t,\\r\\n]'\nconst jsonl = '{\"a\":1,\"b\"  :2 }\\n{\"a\":3\\t,\"b\"\\t:4}\\r\\n{\"a\":5,\"b\":6}\\r'\nconst jsonc = `[\\t\\r\\n{\"a\":1,\"b\":2/* test\nabc*/\\r}\\t,\\r\\n{\"a\":3,\"b\":4}, // test\n{\"a\":5,\"b\":6}\\t,\\r\\n]`\n\nconst bigJson = (count: number) => {\n  const a: string[] = []\n  for (let i = 0; i < count; ++i) {\n    a.push('{\"a\":1,\"b\":2}')\n  }\n  return \"[\" + a.join(\",\") + \"]\"\n}\n\nconst bigJsonLines = (count: number) => {\n  const a: string[] = []\n  for (let i = 0; i < count; ++i) {\n    a.push('{\"a\":1,\"b\":2}')\n  }\n  return a.join(\"\\n\")\n}\n\nconst bigJsonWithComments = (count: number) => {\n  const a: string[] = []\n  for (let i = 0; i < count; ++i) {\n    a.push(`{\"a\":1/* test\n    abc */,\"b\":2} // test\n    `)\n  }\n  return \"[\" + a.join(\",\") + \"]\"\n}\n\nconst test = async () => {\n  console.group(\"JSON\")\n  {\n    await source(json)\n      .pipeThrough(deserializer(undefined))\n      .pipeTo(logging())\n  }\n  console.groupEnd()\n\n  console.group(\"JSON Lines\")\n  {\n    await source(jsonl)\n      .pipeThrough(deserializer({ lineSeparated: true }))\n      .pipeTo(logging())\n  }\n  console.groupEnd()\n\n  console.group(\"JSON with comments\")\n  {\n    await source(jsonc)\n      .pipeThrough(deserializer({ withComments: true }))\n      .pipeTo(logging())\n  }\n  console.groupEnd()\n\n  await sleep()\n\n  console.group(\"Performance test\")\n  {\n    const count = 100000\n    console.log(\"count\", count)\n\n    const json = bigJson(count)\n    const jsonl = bigJsonLines(count)\n    const jsonc = bigJsonWithComments(count)\n\n    console.group(\"JSON\")\n    await testPerformance(json)\n    console.groupEnd()\n\n    await sleep()\n\n    console.group(\"JSON Lines\")\n    await testPerformance(jsonl, { lineSeparated: true })\n    console.groupEnd()\n\n    await sleep()\n\n    console.group(\"JSON with comments\")\n    await testPerformance(jsonc, { withComments: true })\n    console.groupEnd()\n  }\n  console.groupEnd()\n\n  await sleep()\n}\n\nconsole.group(\"JsonDeserializer\")\nawait test()\nconsole.groupEnd()\n\nconsole.log(\"Test completed.\")"],
  "mappings": "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",
  "names": ["json", "jsonl", "jsonc"]
}
